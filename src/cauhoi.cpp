#include "cauhoi.h"
#include <vector>
#include <algorithm>
#include <random>

CauHoi* taoCauHoi(int id, const string& noiDung, const string& a,
                  const string& b, const string& c, const string& d,
                  char dapAnDung) {
  CauHoi* moi = new CauHoi;
  moi->id = id;
  moi->noiDung = noiDung;
  moi->dapAnA = a;
  moi->dapAnB = b;
  moi->dapAnC = c;
  moi->dapAnD = d;
  moi->dapAnDung = dapAnDung;
  moi->trai = nullptr;
  moi->phai = nullptr;
  return moi;
}

CauHoi* themCauHoi(CauHoi* goc, CauHoi* cauHoiMoi) {
  if (goc == nullptr) {
    return cauHoiMoi;
  }

  if (cauHoiMoi->id < goc->id) {
    goc->trai = themCauHoi(goc->trai, cauHoiMoi);
  } else if (cauHoiMoi->id > goc->id) {
    goc->phai = themCauHoi(goc->phai, cauHoiMoi);
  } else {
    delete cauHoiMoi;
    cout << "Câu hỏi với ID " << cauHoiMoi->id << " đã tồn tại!" << endl;
  }

  return goc;
}

CauHoi* timCauHoi(CauHoi* goc, int id) {
  if (goc == nullptr || goc->id == id) {
    return goc;
  }

  if (id < goc->id) {
    return timCauHoi(goc->trai, id);
  } else {
    return timCauHoi(goc->phai, id);
  }
}

CauHoi* timMin(CauHoi* goc) {
  while (goc->trai != nullptr) {
    goc = goc->trai;
  }
  return goc;
}

CauHoi* xoaCauHoi(CauHoi* goc, int id) {
  if (goc == nullptr) {
    return goc;
  }

  if (id < goc->id) {
    goc->trai = xoaCauHoi(goc->trai, id);
  } else if (id > goc->id) {
    goc->phai = xoaCauHoi(goc->phai, id);
  } else {
    if (goc->trai == nullptr) {
      CauHoi* temp = goc->phai;
      delete goc;
      return temp;
    } else if (goc->phai == nullptr) {
      CauHoi* temp = goc->trai;
      delete goc;
      return temp;
    }

    CauHoi* temp = timMin(goc->phai);
    goc->id = temp->id;
    goc->noiDung = temp->noiDung;
    goc->dapAnA = temp->dapAnA;
    goc->dapAnB = temp->dapAnB;
    goc->dapAnC = temp->dapAnC;
    goc->dapAnD = temp->dapAnD;
    goc->dapAnDung = temp->dapAnDung;
    goc->phai = xoaCauHoi(goc->phai, temp->id);
  }

  return goc;
}

void huyBoCay(CauHoi* goc) {
  if (goc != nullptr) {
    huyBoCay(goc->trai);
    huyBoCay(goc->phai);
    delete goc;
  }
}

void duyetTruoc(CauHoi* goc) {
  if (goc != nullptr) {
    hienThiCauHoi(goc);
    duyetTruoc(goc->trai);
    duyetTruoc(goc->phai);
  }
}

void duyetGiua(CauHoi* goc) {
  if (goc != nullptr) {
    duyetGiua(goc->trai);
    hienThiCauHoi(goc);
    duyetGiua(goc->phai);
  }
}

void duyetSau(CauHoi* goc) {
  if (goc != nullptr) {
    duyetSau(goc->trai);
    duyetSau(goc->phai);
    hienThiCauHoi(goc);
  }
}

void hienThiCauHoi(CauHoi* cauHoi) {
  if (cauHoi != nullptr) {
    cout
        << "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
           "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━";
  }
}

// Hàm nhập câu hỏi mới
void nhapCauHoi(CauHoi*& goc) {
    int id;
    string noiDung, dapAnA, dapAnB, dapAnC, dapAnD;
    char dapAnDung;
    
    cout << "Nhập ID câu hỏi: ";
    cin >> id;
    cin.ignore();
    
    cout << "Nhập nội dung câu hỏi: ";
    getline(cin, noiDung);
    
    cout << "Nhập đáp án A: ";
    getline(cin, dapAnA);
    
    cout << "Nhập đáp án B: ";
    getline(cin, dapAnB);
    
    cout << "Nhập đáp án C: ";
    getline(cin, dapAnC);
    
    cout << "Nhập đáp án D: ";
    getline(cin, dapAnD);
    
    do {
        cout << "Nhập đáp án đúng (A/B/C/D): ";
        cin >> dapAnDung;
        dapAnDung = toupper(dapAnDung);
    } while (dapAnDung != 'A' && dapAnDung != 'B' && dapAnDung != 'C' && dapAnDung != 'D');
    
    CauHoi* cauHoiMoi = taoCauHoi(id, noiDung, dapAnA, dapAnB, dapAnC, dapAnD, dapAnDung);
    goc = themCauHoi(goc, cauHoiMoi);
    
    cout << "Đã thêm câu hỏi thành công!" << endl;
}

// Hàm hiển thị tất cả câu hỏi
void hienThiTatCaCauHoi(CauHoi* goc) {
    if (goc == nullptr) {
        cout << "Chưa có câu hỏi nào!" << endl;
        return;
    }
    
    cout << "╔══════════════════════════════════════════════════════════════════════════════════════╗" << endl;
    cout << "║                                DANH SÁCH CÂU HỎI                                     ║" << endl;
    cout << "╚══════════════════════════════════════════════════════════════════════════════════════╝" << endl;
    
    duyetGiua(goc);
}

// Hàm đếm số câu hỏi
int demSoCauHoi(CauHoi* goc) {
    if (goc == nullptr) {
        return 0;
    }
    return 1 + demSoCauHoi(goc->trai) + demSoCauHoi(goc->phai);
}

// Hàm lấy tất cả câu hỏi vào vector
void layTatCaCauHoi(CauHoi* goc, vector<CauHoi*>& danhSach) {
    if (goc != nullptr) {
        danhSach.push_back(goc);
        layTatCaCauHoi(goc->trai, danhSach);
        layTatCaCauHoi(goc->phai, danhSach);
    }
}

// Hàm lấy câu hỏi ngẫu nhiên
void layCauHoiNgauNhien(CauHoi* goc, vector<CauHoi*>& dsNgauNhien, int soLuong) {
    vector<CauHoi*> tatCaCauHoi;
    layTatCaCauHoi(goc, tatCaCauHoi);
    
    if (tatCaCauHoi.size() <= soLuong) {
        dsNgauNhien = tatCaCauHoi;
        return;
    }
    
    random_device rd;
    mt19937 g(rd());
    shuffle(tatCaCauHoi.begin(), tatCaCauHoi.end(), g);
    
    for (int i = 0; i < soLuong; i++) {
        dsNgauNhien.push_back(tatCaCauHoi[i]);
    }
}